<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System - {{DEVICE_NAME}}</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="container">
        <header class="hero-compact">
            <h1>üõ†Ô∏è System Information</h1>
            <p class="hero-subtitle">System status, diagnostics, and maintenance</p>
            <nav><a href="/config">‚Üê Back to Config</a></nav>
        </header>

        <div class="card">
            <div class="card-header">
                <div class="card-icon">üìä</div>
                <div>
                    <h2 class="card-title">System Status</h2>
                    <p class="card-description">Current system information and resource usage</p>
                </div>
            </div>
            
            <div class="status-grid">
                <div class="status-item">
                    <label>Firmware Version:</label>
                    <span>{{FIRMWARE_VERSION}}</span>
                </div>
                
                <div class="status-item">
                    <label>Flash Usage:</label>
                    <span>{{FLASH_USAGE}}%</span>
                </div>
                
                <div class="status-item">
                    <label>RAM Usage:</label>
                    <span>{{RAM_USAGE}}%</span>
                </div>
                
                <div class="status-item">
                    <label>WiFi Status:</label>
                    <span>{{WIFI_STATUS}}</span>
                </div>
                
                <div class="status-item">
                    <label>Audio System:</label>
                    <span>{{AUDIO_STATUS}}</span>
                </div>
                
                <div class="status-item">
                    <label>Uptime:</label>
                    <span id="uptime">{{UPTIME}}</span>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-icon">üöÄ</div>
                <div>
                    <h2 class="card-title">Firmware Update</h2>
                    <p class="card-description">Check for and install firmware updates</p>
                </div>
            </div>
            
            <div class="status-grid">
                <div class="status-item">
                    <label>Current Version:</label>
                    <span>{{FIRMWARE_VERSION}}</span>
                </div>
                
                <div class="status-item">
                    <label>Latest Available:</label>
                    <span id="latest-version">Checking...</span>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="button" onclick="checkUpdate()" class="btn btn-info">üîÑ Check for Updates</button>
                <button type="button" onclick="location.href='/update'" class="btn">üìÅ Manual Update</button>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-icon">üîç</div>
                <div>
                    <h2 class="card-title">Diagnostics</h2>
                    <p class="card-description">System diagnostics and log management</p>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="button" onclick="runDiagnostics()" class="btn btn-info">üîç Run Diagnostics</button>
                <button type="button" onclick="exportLogs()" class="btn">üìÑ Export Logs</button>
                <button type="button" onclick="clearLogs()" class="btn btn-warning">üóëÔ∏è Clear Logs</button>
            </div>
            
            <div id="diagnostic-results"></div>
        </div>
    </div>

    <script>
        function checkUpdate() {
            document.getElementById('latest-version').textContent = 'Checking...';
            
            fetch('/api/check-update')
                .then(r => r.json())
                .then(data => {
                    document.getElementById('latest-version').textContent = data.latestVersion;
                    if (data.updateAvailable) {
                        if (confirm('Update available! Download and install?')) {
                            installUpdate();
                        }
                    }
                })
                .catch(e => {
                    document.getElementById('latest-version').textContent = 'Check failed';
                    console.log('Update check failed:', e);
                });
        }
        
        function installUpdate() {
            fetch('/api/install-update', { method: 'POST' })
                .then(() => {
                    alert('Update started. Device will restart when complete.');
                })
                .catch(e => console.log('Update failed:', e));
        }
        
        function runDiagnostics() {
            document.getElementById('diagnostic-results').innerHTML = 'Running diagnostics...';
            
            fetch('/api/diagnostics')
                .then(r => r.json())
                .then(data => {
                    let html = '<h3>Diagnostic Results</h3><ul>';
                    data.results.forEach(result => {
                        html += `<li><strong>${result.test}:</strong> ${result.status}</li>`;
                    });
                    html += '</ul>';
                    document.getElementById('diagnostic-results').innerHTML = html;
                })
                .catch(e => {
                    document.getElementById('diagnostic-results').innerHTML = 'Diagnostics failed';
                    console.log('Diagnostics failed:', e);
                });
        }
        
        function exportLogs() {
            fetch('/api/logs')
                .then(r => r.blob())
                .then(blob => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'battlearua-logs.txt';
                    a.click();
                })
                .catch(e => console.log('Log export failed:', e));
        }
        
        function clearLogs() {
            if (confirm('Clear all diagnostic logs?')) {
                fetch('/api/logs', { method: 'DELETE' })
                    .then(() => alert('Logs cleared'))
                    .catch(e => console.log('Log clear failed:', e));
            }
        }
        
        // Auto-refresh uptime every minute
        setInterval(() => {
            fetch('/api/uptime')
                .then(r => r.text())
                .then(uptime => document.getElementById('uptime').textContent = uptime)
                .catch(e => console.log('Uptime refresh failed:', e));
        }, 60000);
    </script>
</body>
</html>